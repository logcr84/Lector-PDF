<div class="container">
  <h1>Listado Oficial de Remates</h1>
  
  <div class="controls">
      <div>
          <button class="filter-btn" [class.active]="filterType === 'all'" (click)="setFilter('all')">Todos</button>
          <button class="filter-btn" [class.active]="filterType === 'propiedad'" (click)="setFilter('propiedad')">Propiedades</button>
          <button class="filter-btn" [class.active]="filterType === 'vehiculo'" (click)="setFilter('vehiculo')">VehÃ­culos</button>
      </div>
      <div>
           <input type="file" (change)="onFileSelected($event)" accept=".pdf" style="display: none;" #fileInput>
           <button class="filter-btn" (click)="fileInput.click()" style="background: #3498db; color: white;">ðŸ“‚ Subir PDF</button>
      </div>
      <div>
           <input type="text" class="search-box" placeholder="Buscar expediente, tÃ­tulo..." (keyup)="onSearch($event)">
      </div>
  </div>

  <div *ngIf="isLoading" style="text-align: center; padding: 20px;">
    Loading... <span style="display:inline-block; animation: spin 1s linear infinite;">â†»</span>
  </div>
  
  <div *ngIf="error" style="color: red; text-align: center;">{{ error }}</div>

  <div id="itemsContainer">
      <div *ngFor="let item of filteredRemates">
        
        <!-- Accordion Header -->
        <button class="accordion" 
                [ngClass]="{'prop-item': item.tipo === 'Propiedad', 'car-item': item.tipo === 'Vehiculo', 'active': item.expanded}" 
                (click)="toggleExpand(item)">
            <div class="header-grid">
                <span class="h-id">#{{ item.id }}</span>
                <span class="h-title">{{ item.titulo }}</span>
                <span class="h-area">{{ item.area || '--' }}</span>
                <span class="h-price">{{ item.precioBaseDisplay }}</span>
            </div>
        </button>

        <!-- Panel Content -->
        <div class="panel" [style.display]="item.expanded ? 'block' : 'none'">
            <div class="panel-content">
                <span class="badge" [ngClass]="{'bg-prop': item.tipo === 'Propiedad', 'bg-car': item.tipo === 'Vehiculo'}">{{ item.tipo }}</span>
                
                <div class="remates-grid">
                    <div class="remate-card" *ngFor="let remate of item.remates">
                        <span class="remate-label">{{ remate.label }}</span>
                        <span class="remate-price">{{ remate.precioDisplay }}</span>
                        <span class="remate-date">{{ remate.fecha }}</span>
                    </div>
                    <div *ngIf="item.remates.length === 0" class="remate-card" style="grid-column: 1/-1;">
                        <span class="remate-price">{{ item.precioBaseDisplay }}</span>
                        <span class="remate-date">Verificar fechas en texto original</span>
                    </div>
                </div>

                <div class="expediente-info"><strong>EXP:</strong> {{ item.expediente }}</div>
                
                <div class="details-box">
                    <div class="section-title">Detalles & Legal</div>
                    <div class="detail-row"><span class="detail-key">ID Interno:</span> <span class="detail-value">{{ item.id }}</span></div>
                    <!-- Vehicle-specific fields -->
                    <div class="detail-row" *ngIf="item.detalles?.['Motor']"><span class="detail-key">Motor:</span> <span class="detail-value">{{ item.detalles['Motor'] }}</span></div>
                    <div class="detail-row" *ngIf="item.detalles?.['Placa']"><span class="detail-key">Placa:</span> <span class="detail-value">{{ item.detalles['Placa'] }}</span></div>
                    <!-- Property-specific fields -->
                    <div class="detail-row" *ngIf="item.detalles?.['Naturaleza']"><span class="detail-key">Naturaleza:</span> <span class="detail-value">{{ item.detalles['Naturaleza'] }}</span></div>
                    <div class="detail-row" *ngIf="item.detalles?.['Colindantes']"><span class="detail-key">Colindantes:</span> <span class="detail-value">{{ item.detalles['Colindantes'] }}</span></div>
                    <!-- Common fields in order -->
                    <div class="detail-row" *ngIf="item.expediente"><span class="detail-key">Expediente:</span> <span class="detail-value">{{ item.expediente }}</span></div>
                    <div class="detail-row" *ngIf="item.juzgado"><span class="detail-key">Juzgado:</span> <span class="detail-value">{{ item.juzgado }}</span></div>
                    <div class="detail-row" *ngIf="item.demandado"><span class="detail-key">Demandado:</span> <span class="detail-value">{{ item.demandado }}</span></div>
                    
                    <div style="margin-top:10px; font-size: 0.8em; color: #999;">
                        <em>Texto original extraÃ­do: {{ item.textoOriginal | slice:0:300 }}...</em>
                    </div>
                </div>
            </div>
        </div>

      </div>

      <div *ngIf="filteredRemates.length === 0 && !isLoading && !error" style="text-align: center; color: #777; padding: 40px 20px;">
        <div style="font-size: 1.2em; margin-bottom: 10px;">ðŸ“„ No hay elementos para mostrar</div>
        <div style="font-size: 0.9em;">
          Sube un <strong>boletÃ­n oficial de remates del Poder Judicial</strong> en formato PDF.<br>
          El archivo debe contener informaciÃ³n como expedientes, precios base, y fechas de remate.
        </div>
      </div>
  </div>
</div>
